services:
  # User DB & Service
  user-db:
    image: postgres:15
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: userpass
      POSTGRES_DB: userdb
    ports:
      - "5435:5432"

  user-service:
    build: ./user-service
    environment:
      DATABASE_URL: postgres://user:userpass@user-db:5432/userdb
    ports:
      - "5000:5000"
    depends_on:
      - user-db

  # Product DB & Service
  product-db:
    image: postgres:15
    environment:
      POSTGRES_USER: product
      POSTGRES_PASSWORD: productpass
      POSTGRES_DB: productdb
    ports:
      - "5436:5432"

  product-service:
    build: ./product-service
    environment:
      DATABASE_URL: postgres://product:productpass@product-db:5432/productdb
    ports:
      - "5001:5001"
    depends_on:
      - product-db

  # Order DB & Service
  order-db:
    image: postgres:15
    environment:
      POSTGRES_USER: order
      POSTGRES_PASSWORD: orderpass
      POSTGRES_DB: orderdb
    ports:
      - "5437:5432"

  order-service:
    build: ./order-service
    environment:
      DATABASE_URL: postgres://order:orderpass@order-db:5432/orderdb
    ports:
      - "5002:5002"
    depends_on:
      - order-db

  # Payment DB & Service
  payment-db:
    image: postgres:15
    environment:
      POSTGRES_USER: payment
      POSTGRES_PASSWORD: paymentpass
      POSTGRES_DB: paymentdb
    ports:
      - "5438:5432"

  payment-service:
    build: ./payment-service
    environment:
      DATABASE_URL: postgres://payment:paymentpass@payment-db:5432/paymentdb
    ports:
      - "5003:5003"
    depends_on:
      - payment-db
